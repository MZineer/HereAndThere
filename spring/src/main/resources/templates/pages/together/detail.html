<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Here And There</title>
    <th:block th:replace="fragments/head :: head"></th:block>
    <script type="text/javascript" th:src="'//dapi.kakao.com/v2/maps/sdk.js?appkey=' + ${apiKey}"></script>
</head>
<body>
<div class="container">
    <header th:replace="fragments/header :: header"></header>
    <main>
        <form>
            <div class="mb-3">
                <label for="title" class="form-label">제목</label>
                <input type="text" class="form-control" id="title" name="title" th:value="${together.title}"
                       placeholder="제목" disabled>
            </div>
            <div class="mb-3">
                <label for="user_name" class="form-label">작성자</label>
                <input type="text" class="form-control" id="user_name" name="user_name" th:value="${user.user_name}"
                       disabled>
            </div>
            <div class="mb-3">
                <label for="content" class="form-label">내용</label>
                <input type="text" class="form-control" id="content" name="content" th:value="${together.content}"
                       disabled>
            </div>
            <div class="mb-3">
                <label for="departure_date" class="form-label">출발일</label>
                <input type="text" class="form-control" id="departure_date" name="departure_date"
                       th:value="${together.departure_date}" disabled>
            </div>
            <div class="mb-3">
                <label for="arrival_date" class="form-label">도착일</label>
                <input type="datetime-local" class="form-control" id="arrival_date" name="arrival_date"
                       th:value="${together.arrival_date}" disabled>
            </div>
            <div class="mb-3">
                <label for="tourist_attrs_list" class="form-label">코스</label>
                <input type="text" class="form-control" id="tourist_attrs_list" name="tourist_attrs_list"
                       th:value="${route.tourist_attrs_list}" disabled>
            </div>
            <div class="mb-3" id="map_window">
                <div id="map" style="height: 500px">

                </div>
            </div>
        </form>
    </main>
    <footer th:replace="fragments/footer :: footer"></footer>
</div>
<script>

    function displayRoute(routes) {
        var mapContainer = document.getElementById('map'), // 지도를 표시할 div
            mapOption = {
                center: routes[0].latlng, // 지도의 중심좌표
                level: 5 // 지도의 확대 레벨
            };

        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

// 마커 이미지의 이미지 주소입니다
        var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

        for (var i = 0; i < routes.length; i++) {

            // 마커 이미지의 이미지 크기 입니다
            var imageSize = new kakao.maps.Size(24, 35);

            // 마커 이미지를 생성합니다
            var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                map: map, // 마커를 표시할 지도
                position: routes[i].latlng, // 마커를 표시할 위치
                title: routes[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
                image: markerImage // 마커 이미지
            });
        }
    }

    $(function () {
        var route = $("#tourist_attrs_list").attr("value");
        $.ajax({
            type: "GET",
            url: "/route/cord/get",
            data: {route: route},
            success: function (response) {
                // 성공적으로 데이터를 전송한 경우 실행할 코드
                console.log(response); // 서버 응답 확인

                var routes = response.body;

                var routes_cord = [];

                for (var i = 0; i < routes.length; i++) {
                    var cord = {
                        title: routes[i].name,
                        latlng: new kakao.maps.LatLng(parseFloat(routes[i].lat), parseFloat(routes[i].lng))
                    }
                    routes_cord.push(cord);
                }
                displayRoute(routes_cord); // 경로 표시 함수 호출
            },
            error: function (xhr, status, error) {
                console.error(xhr.responseText);
            }
        });
    });
</script>
</body>
</html>